(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{366:function(t,e,r){t.exports=r.p+"assets/img/vpnGWPIP.ef0fe4eb.png"},367:function(t,e,r){t.exports=r.p+"assets/img/vpn0.b2dfe067.png"},368:function(t,e,r){t.exports=r.p+"assets/img/vpn1.ceece175.png"},369:function(t,e,r){t.exports=r.p+"assets/img/vpn2.c2bae65a.png"},370:function(t,e,r){t.exports=r.p+"assets/img/vpn3.5e26f77c.png"},371:function(t,e,r){t.exports=r.p+"assets/img/vpn4.b056a73c.png"},372:function(t,e,r){t.exports=r.p+"assets/img/vpn5.dad472fd.png"},373:function(t,e,r){t.exports=r.p+"assets/img/EnablePingInAzureVM.b133fb7b.png"},602:function(t,e,r){"use strict";r.r(e);var a=r(42),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"challenge-8-networking-vpn-enabling-hybrid-networking-with-a-site-2-site-onprem-to-azure-vpn-connection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#challenge-8-networking-vpn-enabling-hybrid-networking-with-a-site-2-site-onprem-to-azure-vpn-connection"}},[t._v("#")]),t._v(" Challenge 8: Networking - VPN: Enabling Hybrid Networking with a Site-2-Site (Onprem to Azure) VPN Connection")]),t._v(" "),a("p",[a("RouterLink",{attrs:{to:"/day1/"}},[t._v("back")])],1),t._v(" "),a("h2",{attrs:{id:"here-is-what-you-will-learn"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#here-is-what-you-will-learn"}},[t._v("#")]),t._v(" Here is what you will learn")]),t._v(" "),a("ul",[a("li",[t._v("What it takes to implement a VPN tunnel between your onprem firewall <---VPN S2S---\x3e Azure")])]),t._v(" "),a("h2",{attrs:{id:"an-azure-s2s-vpn-requires"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#an-azure-s2s-vpn-requires"}},[t._v("#")]),t._v(" An Azure S2S VPN requires:")]),t._v(" "),a("p",[a("strong",[t._v("Azure")])]),t._v(" "),a("ul",[a("li",[t._v("VPN Gateway in its own subnet.")]),t._v(" "),a("li",[t._v("VPN GWay requires a dynamic Public IP")]),t._v(" "),a("li",[t._v("Settings how the onprem VPN / FWall is to be contacted (aka LocalNetworkGateway)")]),t._v(" "),a("li",[t._v("Connection Objekt with e.g. shared key")])]),t._v(" "),a("p",[a("strong",[t._v("onprem")])]),t._v(" "),a("ul",[a("li",[t._v("A supported device Azure can talk to.")])]),t._v(" "),a("h2",{attrs:{id:"create-a-vpn-gateway-and-a-public-ip-using-the-portal"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-a-vpn-gateway-and-a-public-ip-using-the-portal"}},[t._v("#")]),t._v(" Create a VPN Gateway and a Public IP using the portal")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[Azure Portal] -> '+ Create a resource' -> type \"Virtual network gateway\"\n  -> Create\n")])])]),a("p",[a("strong",[t._v("Use the following parameter values")]),t._v(":")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Parameter Name")]),t._v(" "),a("th",[t._v("Values")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Name")]),t._v(" "),a("td",[a("strong",[t._v("myAzVPNGWay")])])]),t._v(" "),a("tr",[a("td",[t._v("Region")]),t._v(" "),a("td",[a("strong",[t._v("North Europe")])])]),t._v(" "),a("tr",[a("td",[t._v("Gateway type")]),t._v(" "),a("td",[t._v("VPN")])]),t._v(" "),a("tr",[a("td",[t._v("VPN Type")]),t._v(" "),a("td",[t._v("Route based")])]),t._v(" "),a("tr",[a("td",[t._v("Gateway type")]),t._v(" "),a("td",[t._v("VPN")])]),t._v(" "),a("tr",[a("td",[t._v("SKU")]),t._v(" "),a("td",[t._v("VpnGw1")])]),t._v(" "),a("tr",[a("td",[t._v("Generation")]),t._v(" "),a("td",[t._v("Generation 1")])]),t._v(" "),a("tr",[a("td",[t._v("Virtual Network")]),t._v(" "),a("td",[a("strong",[t._v("azurevnet")])])]),t._v(" "),a("tr",[a("td",[t._v("Public IP address")]),t._v(" "),a("td",[t._v("create new")])]),t._v(" "),a("tr",[a("td",[t._v("Public IP address name")]),t._v(" "),a("td",[a("strong",[t._v("myAzVPNGWay-IP")])])]),t._v(" "),a("tr",[a("td",[t._v("Enable active-active mode")]),t._v(" "),a("td",[t._v("Disabled")])]),t._v(" "),a("tr",[a("td",[t._v("Configure BGP ASN")]),t._v(" "),a("td",[t._v("Disabled")])])])]),t._v(" "),a("p",[t._v("-> the GW setup will take approx 30 mins. to create -> come back later..."),a("br"),t._v("\nWhen your "),a("strong",[t._v("GW has")]),t._v(" been assigned a "),a("strong",[t._v("public IP")]),t._v(" address then you know "),a("strong",[t._v("it is online")]),t._v("."),a("br"),t._v(" "),a("img",{attrs:{src:r(366),alt:"VPN GW with public IP"}})]),t._v(" "),a("h2",{attrs:{id:"azure-create-a-local-network-gateway"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#azure-create-a-local-network-gateway"}},[t._v("#")]),t._v(" [Azure] Create a Local Network Gateway")]),t._v(" "),a("p",[t._v("The purpose of this task is to tell azure how to contact the onpremise firewall:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[Azure Portal] -> '+ Add' -> type 'Local network gateway' -> Create\n")])])]),a("table",[a("thead",[a("tr",[a("th",[t._v("Parameter Name")]),t._v(" "),a("th",[t._v("Values")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Name")]),t._v(" "),a("td",[a("strong",[t._v("l-gw-ipfire")])])]),t._v(" "),a("tr",[a("td",[t._v("IP address")]),t._v(" "),a("td",[a("strong",[a("em",[t._v("%external IP of your Firewall - ask instructor%")])])])]),t._v(" "),a("tr",[a("td",[t._v("Address Space")]),t._v(" "),a("td",[a("strong",[t._v("192.168.0.0/24")])])]),t._v(" "),a("tr",[a("td",[t._v("Resource Group")]),t._v(" "),a("td",[a("strong",[t._v("rg-contosomortgage-www")])])]),t._v(" "),a("tr",[a("td",[t._v("Location")]),t._v(" "),a("td",[a("strong",[t._v("North Europe")])])])])]),t._v(" "),a("h2",{attrs:{id:"azure-create-a-connection-object-with-shared-key"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#azure-create-a-connection-object-with-shared-key"}},[t._v("#")]),t._v(" [Azure] Create a connection object with shared key")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[Azure Portal] -> Resource Groups -> rg-contosomortgage-www -> myAzVPNGWay\n -> Connections -> \n")])])]),a("table",[a("thead",[a("tr",[a("th",[t._v("Parameter Name")]),t._v(" "),a("th",[t._v("Values")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Name")]),t._v(" "),a("td",[a("strong",[t._v("azure-to-onprem")])])]),t._v(" "),a("tr",[a("td",[t._v("Connection Type")]),t._v(" "),a("td",[a("strong",[t._v("Site-to-Site (IPSec)")])])]),t._v(" "),a("tr",[a("td",[t._v("Virtual Network Gateway")]),t._v(" "),a("td",[a("strong",[t._v("myAzVPNGWay")])])]),t._v(" "),a("tr",[a("td",[t._v("Local Network Gateway")]),t._v(" "),a("td",[a("strong",[t._v("l-gw-ipfire")])])]),t._v(" "),a("tr",[a("td",[t._v("Shared Key")]),t._v(" "),a("td",[t._v("*********** (your choice here)")])]),t._v(" "),a("tr",[a("td",[t._v("IKE Protocol")]),t._v(" "),a("td",[t._v("IKEv2")])]),t._v(" "),a("tr",[a("td",[t._v("Resource Group")]),t._v(" "),a("td",[a("strong",[t._v("rg-contosomortgage-www")])])]),t._v(" "),a("tr",[a("td",[t._v("Location")]),t._v(" "),a("td",[t._v("North Europe")])])])]),t._v(" "),a("h2",{attrs:{id:"onpremise-configure-your-onpremise-vpn-counterpart-e-g-ipfire"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#onpremise-configure-your-onpremise-vpn-counterpart-e-g-ipfire"}},[t._v("#")]),t._v(" [Onpremise] Configure your onpremise VPN counterpart e.g. ipfire")]),t._v(" "),a("p",[a("strong",[t._v("Logon to the IPFire -> ask your instructor.")]),a("br"),t._v("\nOpen a browser and navigate to: https://192.168.0.100:444 -> ignore certificate warning -> proceed")]),t._v(" "),a("p",[a("strong",[t._v("User")]),t._v(": admin"),a("br"),t._v(" "),a("strong",[t._v("Password")]),t._v(": "),a("em",[t._v("Ask your instructor")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("   IPFire -> Services -> IPSec -> 'Connection Status and -Control' -> Add\n")])])]),a("p",[a("img",{attrs:{src:r(367),alt:"IPFire: Add a connection"}})]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('   "Net-to-Net Virtual Private Network" -> Add\n')])])]),a("p",[a("img",{attrs:{src:r(368),alt:"IPFire: add Net-to-Net connection"}})]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Parameter Name")]),t._v(" "),a("th",[t._v("Values")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Name")]),t._v(" "),a("td",[a("strong",[t._v("azure")])])]),t._v(" "),a("tr",[a("td",[t._v("Local subnet")]),t._v(" "),a("td",[t._v("192.168.0.0/255.255.255.0")])]),t._v(" "),a("tr",[a("td",[t._v("Remote Host/IP")]),t._v(" "),a("td",[a("strong",[a("em",[t._v("%'myAzVPNGWay-IP' VPN Gateway PIP in Azure%")])])])]),t._v(" "),a("tr",[a("td",[t._v("Remote subnet")]),t._v(" "),a("td",[a("strong",[a("em",[t._v("%Address Range of the virtual network in azure with mask% (e.g. 10.1.0.0/255.255.0.0)")])])])]),t._v(" "),a("tr",[a("td",[t._v("Use a pre-shared key")]),t._v(" "),a("td",[a("strong",[a("em",[t._v("Shared Key you used in azure before")])])])])])]),t._v(" "),a("p",[a("img",{attrs:{src:r(369),alt:"IPFire: connection settings"}}),t._v(" "),a("strong",[t._v("Save")])]),t._v(" "),a("p",[a("strong",[t._v("Click on the pencil symbol and choose 'Advanced'")]),t._v(":\n"),a("img",{attrs:{src:r(370),alt:"IPFire: Advanced cipher settings"}})]),t._v(" "),a("p",[t._v("Select the "),a("strong",[t._v("following algorithms / suites for the connection")]),t._v(":\n"),a("img",{attrs:{src:r(371),alt:"IPFire: connection settings"}}),a("br"),t._v(" "),a("strong",[t._v("select Always on")]),t._v(" then "),a("strong",[t._v("Save")])]),t._v(" "),a("p",[a("strong",[t._v("Tick checkbox to enable connection")]),t._v(" - connection status should go to green:\n"),a("img",{attrs:{src:r(372),alt:"IPFire: connection settings"}})]),t._v(" "),a("p",[a("strong",[t._v("Now let's ping your azure vm")]),t._v(" (e.g. vmweb01) under its private ip (probably: 10.1.0.4) from onpremise."),a("br"),t._v("\nDo you receive a response?"),a("br"),t._v("\nYou might need to allow ping first"),a("br"),t._v(" "),a("img",{attrs:{src:r(373),alt:"Enable ping in azure vm"}}),t._v(" )")]),t._v(" "),a("p",[a("RouterLink",{attrs:{to:"/day1/"}},[t._v("back")])],1)])}),[],!1,null,null,null);e.default=n.exports}}]);