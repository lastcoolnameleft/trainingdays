(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{599:function(t,e,a){"use strict";a.r(e);var s=a(42),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"challenge-5-storage-account-creating-a-data-storage-for-vms-and-applications"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#challenge-5-storage-account-creating-a-data-storage-for-vms-and-applications"}},[t._v("#")]),t._v(" Challenge 5: Storage Account: Creating a Data Storage for VMs and Applications")]),t._v(" "),a("p",[a("RouterLink",{attrs:{to:"/day1/"}},[t._v("back")])],1),t._v(" "),a("h2",{attrs:{id:"here-is-what-you-will-learn"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#here-is-what-you-will-learn"}},[t._v("#")]),t._v(" Here is what you will learn")]),t._v(" "),a("ul",[a("li",[t._v("how to create an azure storage account using the portal")]),t._v(" "),a("li",[t._v("enable access to the storagage account data (e.g. blobs) using Shared Access Signatures")]),t._v(" "),a("li",[t._v("create a SAS policy to enable permission modification after SAS tokens have been issued.")]),t._v(" "),a("li",[t._v("use AAD credentials as 'better' way for storage account authorization")]),t._v(" "),a("li",[t._v("create a file share and attach it to your azure virtual machine")])]),t._v(" "),a("h2",{attrs:{id:"create-a-storage-account-and-a-container-using-the-azure-portal"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-a-storage-account-and-a-container-using-the-azure-portal"}},[t._v("#")]),t._v(" Create a storage account and a container using the azure portal")]),t._v(" "),a("ol",[a("li",[t._v("Login to your azure subscription "),a("strong",[t._v("and search the marketplace for 'Storage Account'")]),a("br"),t._v(" "),a("img",{attrs:{src:"sa01.PNG",alt:"Storage Account Marketplace Item"}}),a("br"),t._v(" "),a("strong",[t._v("Create a storage account")]),t._v(" with the following values:")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[t._v("Value")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Resource Group")]),t._v(" "),a("td",[a("strong",[t._v("(new)")]),t._v(" rg-sachallenge")])]),t._v(" "),a("tr",[a("td",[t._v("Storage account name")]),t._v(" "),a("td",[a("em",[t._v("%unique lowercase value%")])])]),t._v(" "),a("tr",[a("td",[t._v("Location")]),t._v(" "),a("td",[a("strong",[t._v("North Europe")])])]),t._v(" "),a("tr",[a("td",[t._v("Account kind")]),t._v(" "),a("td",[t._v("StorageV2")])]),t._v(" "),a("tr",[a("td",[t._v("Performance")]),t._v(" "),a("td",[t._v("Standard")])]),t._v(" "),a("tr",[a("td",[t._v("Replication")]),t._v(" "),a("td",[a("strong",[t._v("Locally-redundand storage (LRS)")])])]),t._v(" "),a("tr",[a("td",[t._v("Access tier")]),t._v(" "),a("td",[t._v("Hot")])])])]),t._v(" "),a("p",[t._v("See some use cases for SAS / "),a("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/storage/common/storage-sas-overview#when-to-use-a-shared-access-signature",target:"_blank",rel:"noopener noreferrer"}},[t._v("SAS use cases"),a("OutboundLink")],1)]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("Once the sa is created - "),a("strong",[t._v('generate a new "container"')]),t._v(" within the storage account:")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('[Azure Portal] -> %Your Storage Account% -> Containers -> "+ Container"\n')])])]),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[t._v("Value")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Name")]),t._v(" "),a("td",[a("strong",[t._v("secured")])])]),t._v(" "),a("tr",[a("td",[t._v("Public access level")]),t._v(" "),a("td",[t._v("Private (no anonymous access)")])])])]),t._v(" "),a("p",[t._v("Now "),a("strong",[t._v("upload a small file")]),t._v("."),a("br"),t._v(" "),a("img",{attrs:{src:"sa02.PNG",alt:"Upload a txt file to a storage account"}})]),t._v(" "),a("p",[a("strong",[t._v("Can you download the file")]),t._v(" using its URI in another browser session?"),a("br"),t._v(" "),a("img",{attrs:{src:"sa03.PNG",alt:"Download URI"}}),a("br"),t._v("\nAnswer: No. Because anonymous access is not allowed and this URI does not 'carry' any auth token.")]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[a("strong",[t._v("Create a Shared Access Signature")]),t._v(" [via the portal] to enable blob access.")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('[Azure Portal] -> %Your Storage Account% -> Shared access signature -> "Generate SAS and connection string"\n')])])]),a("p",[a("strong",[t._v("Copy the Blob Service SAS URL to the clipboard")]),t._v(" "),a("img",{attrs:{src:"sas01.PNG",alt:"SAS URL"}})]),t._v(" "),a("p",[a("strong",[t._v("Edit the SAS URL")]),t._v(": You need to add the path to uploaded file - it should look similar to:")]),t._v(" "),a("blockquote",[a("p",[t._v("https://"),a("strong",[t._v("%Your Storage Account Name%")]),t._v(".blob.core.windows.net/"),a("strong",[t._v("secured/HelloWorld.txt")]),t._v("?sv=2019-02-02&ss=bfqt&srt=sco&sp=rwdlacup&se=2020-01-26T00:03:42Z&st=2020-01-25T16:03:42Z&spr=https&sig=Pehc....")])]),t._v(" "),a("p",[a("strong",[t._v("Can you now download the file")]),t._v(" in the browser [Yes]")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("Note")]),t._v(": If a SAS,...")]),t._v(" "),a("ul",[a("li",[t._v("... is leaked, it can be used by anyone who obtains it, which can potentially compromise your storage account.")]),t._v(" "),a("li",[t._v("... provided to a client application expires and the application is unable to retrieve a new SAS from your service, then the application's functionality may be hindered.")])])]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("[optional] "),a("strong",[t._v("Revoke the storage account's access key1")]),t._v(".")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[Azure Portal] -> %Your Storage Account% -> Access keys -> key1 -> 'regenerate'\n")])])]),a("p",[t._v("Can you still download the file in the browser using aboves URL [No]"),a("br"),t._v("\nWhy? Because the SAS key was generated using the previous key1 -> which is no longer valid.")]),t._v(" "),a("h2",{attrs:{id:"create-a-stored-access-policy-to-control-permissions-after-sas-token-is-issued"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-a-stored-access-policy-to-control-permissions-after-sas-token-is-issued"}},[t._v("#")]),t._v(" Create a stored access policy to control permissions after SAS token is issued.")]),t._v(" "),a("ol",[a("li",[t._v('Define a stored access policy on the container "securedap" (write)')])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[Azure Portal] -> %Your Storage Account% -> Containers -> 'secured' -> Access policy -> 'Storage access policy' -> '+' Add policy\n")])])]),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[t._v("Value")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Identifier")]),t._v(" "),a("td",[a("strong",[t._v("securedap")])])]),t._v(" "),a("tr",[a("td",[t._v("Permissions")]),t._v(" "),a("td",[a("strong",[t._v("Write")])])])])]),t._v(" "),a("p",[a("strong",[t._v("Note")]),t._v(" Don't forget to use the "),a("strong",[t._v("save")]),t._v(" button!"),a("br"),t._v(" "),a("img",{attrs:{src:"saaccpol01.PNG",alt:"Access policy"}})]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[a("strong",[t._v("Create a SAS URL that is using this access policy")]),t._v(" using Azure Storage Explorer"),a("br"),t._v(" "),a("strong",[t._v("Open")]),t._v(" "),a("a",{attrs:{href:"https://azure.microsoft.com/en-us/features/storage-explorer/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Microsoft Azure Storage Explorer"),a("OutboundLink")],1),t._v(" and  "),a("RouterLink",{attrs:{to:"/day2/challenges/challenge-0.html"}},[t._v("See Also Day 2: Challenge 0 - Setup your System")]),t._v(" "),a("strong",[t._v("Navigate to your storage account")]),t._v(" and container."),a("br"),t._v(" "),a("strong",[t._v("Right click")]),t._v(" and do 'Get Shared Access Signature' based on our policy."),a("br"),t._v(" "),a("img",{attrs:{src:"saaccpol02.PNG",alt:"Storage Explorer generate SAS URI"}}),a("br"),t._v(" "),a("strong",[t._v("Copy the URI")]),t._v(" to the clipboard."),a("br"),t._v(" "),a("strong",[t._v("Edit the SAS URI")]),t._v(" -> add the path to uploaded file -> can you now download the file in the browser [No]"),a("br"),t._v(" "),a("strong",[t._v("Edit the stored access policy 'securedap' to allow READ access")])],1)]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[Azure Portal] -> %Your Storage Account% -> Containers -> 'secured' -> Access policy -> Under 'Storage access policy' -> 'securedap' -> '...' -> Edit -> Permissions -> Add READ -> OK -> Save\n")])])]),a("p",[a("img",{attrs:{src:"saaccpol03.PNG",alt:"RW Access Policy"}}),a("br"),t._v(" "),a("strong",[t._v("Can you now download the file in the browser")]),t._v(" [Yes]")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("Note")]),t._v(":"),a("br"),t._v("\nWhen you now distribute this SAS URI to users or Apps you can later modify it's behaviour by modifying the access policy."),a("br"),t._v("\nSo stored access policies can help to modify permissions to a container after the SAS has been issued to users / apps.")])]),t._v(" "),a("h2",{attrs:{id:"optional-authorize-access-to-blobs-using-aad"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#optional-authorize-access-to-blobs-using-aad"}},[t._v("#")]),t._v(" [optional] Authorize access to blobs using AAD")]),t._v(" "),a("p",[a("strong",[t._v("You can")]),t._v(" also "),a("strong",[t._v("authorize access to storage accounts using Azure Active Directory (AAD) credentials")]),t._v(". "),a("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/storage/common/storage-auth-aad?toc=%2fazure%2fstorage%2fblobs%2ftoc.json",target:"_blank",rel:"noopener noreferrer"}},[t._v("See"),a("OutboundLink")],1),a("br"),t._v("\nAnd in fact this "),a("strong",[t._v("is the recommended way")]),t._v("."),a("br"),t._v("\nApps however might want to use 'service accounts' aka Service Principals in Azure."),a("br"),t._v("\nThe following PowerShell code creates a Service Principal in AAD. You can give this 'user' permissions to your storage account -> container")]),t._v(" "),a("div",{staticClass:"language-PowerShell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Login to your azure subscription")]),t._v("\nLogin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("AzAccount \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Right subscription selected?")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-AzSubscription")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Out-GridView")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Title "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Select working context"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("OutputMode Single "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Set-AzContext")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Get your AAD ID")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$tenantID")]),t._v(" = $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-AzContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Tenant"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#e.g. '72f988bf-8.....'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#create service principal with null rights in AAD")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$servicePrincipalName")]),t._v(" = "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mySaSP...."')]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#must be unique within AAD tenant")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sp")]),t._v(" = "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("New-AzADServicePrincipal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("DisplayName "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$servicePrincipalName")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Role "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$null")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#save password for later logon (see below).")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BSTR")]),t._v(" = "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[System.Runtime.InteropServices.Marshal]")]),t._v("::SecureStringToBSTR"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Secret"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$UnsecureSecret")]),t._v(" = "),a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("[System.Runtime.InteropServices.Marshal]")]),t._v("::PtrToStringAuto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BSTR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('<#now assign this service principal storage account contributor rights in the Portal.\n[Azure Portal] -> %Your Storage Account% -> Containers -> \'secured\' ->  Access Control (IAM) -> Add a role assignment...\n    Role: e.g. "Storage Blob Data Owner"\n    Select: "mySaSP..."\n#>')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Now sign in as this service principal")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$passwd")]),t._v(" = "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ConvertTo-SecureString")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$UnsecureSecret")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("AsPlainText "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Force\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$pscredential")]),t._v(" = "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("New-Object")]),t._v(" System"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Management"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Automation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PSCredential"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ServicePrincipalNames"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$passwd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Connect-AzAccount")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("ServicePrincipal "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Credential "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$pscredential")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Tenant "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$tenantID")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ctx")]),t._v(" = "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$null")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ctx")]),t._v(" = "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("New-AzStorageContext")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("StorageAccountName "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%Your Storage account name%"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("UseConnectedAccount\n"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$container")]),t._v(" = "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-AzStorageContainer")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Context "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ctx")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Name "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'secured'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-AzStorageBlob")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Container $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$container")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Context "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ctx")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#in case of error - do you have the correct role permissions? (e.g. Storage Blob Data Contributor)")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Get-AzRoleAssignment -ServicePrincipalName $sp.ServicePrincipalNames[0]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-AzStorageBlob")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Container $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$container")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Context "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$ctx")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("out-gridview")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Title "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Select blob to download to c:\\temp'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("OutputMode Single "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-AzStorageBlobContent")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Destination "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'c:\\temp'")]),t._v("\n\nLogout"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("AzAccount "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Username "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$sp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ServicePrincipalNames"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("0"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#cleanup")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Read-Host")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Prompt "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Ready to cleanup? (key)"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Login to your azure subscription")]),t._v("\nLogin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("AzAccount \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Right subscription selected?")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Get-AzSubscription")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Out-GridView")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Title "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Select working context"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("OutputMode Single "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Set-AzContext")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Remove-AzADServicePrincipal")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("DisplayName "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$servicePrincipalName")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Force\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Remove-AzADApplication")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("DisplayName "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$servicePrincipalName")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Force\n")])])]),a("h2",{attrs:{id:"add-an-azure-file-share-to-a-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#add-an-azure-file-share-to-a-server"}},[t._v("#")]),t._v(" Add an azure file share to a server.")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("Add the file share")]),t._v(" via the portal:")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('[Azure Portal] -> Storage Account -> File Shares -> "+" File Share\n')])])]),a("table",[a("thead",[a("tr",[a("th",[t._v("Name")]),t._v(" "),a("th",[t._v("Value")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Name")]),t._v(" "),a("td",[a("strong",[t._v("myfiles")])])]),t._v(" "),a("tr",[a("td",[t._v("Quota")]),t._v(" "),a("td",[a("em",[t._v("empty")])])])])]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[a("strong",[t._v("In your Azure VM mount the share")]),t._v(" as drive by executing the command taken from:")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[Azure Portal] -> Storage Account -> File Shares -> 'myfiles' -> Connect -> copy the code into the clipboard\n")])])]),a("p",[a("img",{attrs:{src:"azfiles01.PNG",alt:"Azure Files"}}),t._v(")")]),t._v(" "),a("p",[t._v("In your VM paste the code into a PowerShell window and execute it. Once successful your 'drive' has been mounted."),a("br"),t._v(" "),a("img",{attrs:{src:"azfiles02.PNG",alt:"Mounted Azure File Share"}})]),t._v(" "),a("blockquote",[a("p",[t._v("Questions:")]),t._v(" "),a("ul",[a("li",[t._v("What is the default quota of an azure file share?")]),t._v(" "),a("li",[t._v("Which user account is used for establishing the connection?")]),t._v(" "),a("li",[t._v("Is the 'drive' available to other users that logon to the VM? [No]")]),t._v(" "),a("li",[t._v("Is the 'drive' mounted 'automatically' after a reboot? [Yes]")])])]),t._v(" "),a("p",[a("RouterLink",{attrs:{to:"/day1/"}},[t._v("back")])],1)])}),[],!1,null,null,null);e.default=r.exports}}]);