(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{638:function(e,t,a){"use strict";a.r(t);var r=a(42),o=Object(r.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"challenge-0-request-an-id-token-from-azure-ad"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#challenge-0-request-an-id-token-from-azure-ad"}},[e._v("#")]),e._v(" Challenge-0: Request an ID Token from Azure AD")]),e._v(" "),a("h2",{attrs:{id:"here-is-what-you-will-learn"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#here-is-what-you-will-learn"}},[e._v("#")]),e._v(" Here is what you will learn")]),e._v(" "),a("ul",[a("li",[e._v("How to register an application in Azure AD")]),e._v(" "),a("li",[e._v("How to use the OpenIDConnect protocol to authenticate users")]),e._v(" "),a("li",[e._v("How to receive an "),a("strong",[e._v("id_token")]),e._v(" with basic profile information of the authenticated user")])]),e._v(" "),a("p",[e._v("Here is an high-level overview of the authentication process:\n"),a("img",{attrs:{src:"images/oidc-id-token-flow.png",alt:"Flow"}})]),e._v(" "),a("p",[e._v("In short:")]),e._v(" "),a("ol",[a("li",[e._v("We show the user a sign-in button")]),e._v(" "),a("li",[e._v("The sign-in button forwards to the "),a("code",[e._v(".../oauth2/v2.0/authorize")]),e._v(" URL, including the ID of our application and the ID of our AAD tenant")]),e._v(" "),a("li",[e._v("The user logs in and consents to letting us access his or her profile")]),e._v(" "),a("li",[e._v("Our AAD tenants forwards us to the callback URL and includes an "),a("code",[e._v("id_token")]),e._v(", which contains basic profile information of the user in form of a JWT (JSON Web Token)")]),e._v(" "),a("li",[e._v("Lastly, we could validate the returned "),a("code",[e._v("id_token")]),e._v(" using its signature (not shown here, most libraries do this for us)")])]),e._v(" "),a("h2",{attrs:{id:"create-an-azure-ad-application"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-an-azure-ad-application"}},[e._v("#")]),e._v(" Create an Azure AD application")]),e._v(" "),a("p",[e._v("Before we can authenticate a user we have to register an application in our Azure AD tenant.")]),e._v(" "),a("h3",{attrs:{id:"azure-cli"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#azure-cli"}},[e._v("#")]),e._v(" Azure CLI")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("az ad app create --display-name challengeidtokencli --reply-urls http://localhost:5001/api/tokenecho --identifier-uris https://challengeidtoken\n")])])]),a("p",[a("strong",[e._v("Note:")]),e._v(" The "),a("code",[e._v("IdentifierUri")]),e._v(" needs to be unique within an instance of AAD.")]),e._v(" "),a("p",[e._v("Retrieve the ID of your current Azure AD tenant via:")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("az account show \n")])])]),a("h3",{attrs:{id:"viewing-your-applicationid"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#viewing-your-applicationid"}},[e._v("#")]),e._v(" Viewing your ApplicationId")]),e._v(" "),a("p",[e._v("Note down the "),a("code",[e._v("appId")]),e._v(" value in the response - this is the id under which your AAD application has been registered. In the Azure Portal, we can see your new app registration under "),a("code",[e._v("AAD --\x3e App Registrations --\x3e Owned applications")]),e._v(":")]),e._v(" "),a("p",[a("img",{attrs:{src:"images/aad_app_registration.png",alt:"alt-text"}})]),e._v(" "),a("h2",{attrs:{id:"run-the-token-echo-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#run-the-token-echo-server"}},[e._v("#")]),e._v(" Run the Token Echo Server")]),e._v(" "),a("p",[e._v("Open another shell and run the Token Echo Server from "),a("a",{attrs:{href:"../apps/token-echo-server"}},[a("code",[e._v("day5/apps/token-echo-server")])]),e._v(' in this repository. This helper ASP.NET Core tool is used to echo the token issued by your AAD and "simulates" our website or server backend that would receive the '),a("code",[e._v("id_token")]),e._v(".")]),e._v(" "),a("p",[e._v("The tool is listening on port 5001 on your local machine. Tokens are accepted on the route "),a("code",[e._v("http://localhost:5001/api/tokenecho")]),e._v(". This is why we initially registered an AAD application with a reply url pointing to "),a("code",[e._v("http://localhost:5001/api/tokenecho")]),e._v(".")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("dotnet run\n")])])]),a("h2",{attrs:{id:"create-an-authentication-request"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-an-authentication-request"}},[e._v("#")]),e._v(" Create an authentication request")]),e._v(" "),a("p",[e._v("Replace "),a("code",[e._v("TENANT_ID")]),e._v(" with your AAD Tenant Id and "),a("code",[e._v("APPLICATION_ID")]),e._v(" with your Application Id. Open a browser and paste the modified request.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("https://login.microsoftonline.com/TENANT_ID/oauth2/v2.0/authorize?\nclient_id=APPLICATION_ID\n&response_type=id_token\n&redirect_uri=http%3A%2F%2Flocalhost%3A5001%2Fapi%2Ftokenecho\n&response_mode=form_post\n&scope=openid%20profile\n&nonce=1234\n")])])]),a("p",[e._v("For explanation, "),a("code",[e._v("openid")]),e._v(" scope allows the user to sign in, and "),a("code",[e._v("profile")]),e._v(" scope allows us to read the basic profile information of the user.")]),e._v(" "),a("p",[e._v("Copy the "),a("code",[e._v("id_token")]),e._v(" value from your browser output, go to "),a("a",{attrs:{href:"https://jwt.ms",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://jwt.ms"),a("OutboundLink")],1),e._v(" and paste the token. Take a minute and have a look at the decoded token.")]),e._v(" "),a("p",[e._v("If you need further information about the issued claims take a look "),a("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/active-directory/develop/id-tokens#header-claims",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1),e._v(".")]),e._v(" "),a("h2",{attrs:{id:"cleanup-resources"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cleanup-resources"}},[e._v("#")]),e._v(" Cleanup resources")]),e._v(" "),a("h3",{attrs:{id:"azure-cli-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#azure-cli-2"}},[e._v("#")]),e._v(" Azure CLI")]),e._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[e._v("az ad app delete --id "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("applicationid"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n")])])]),a("h2",{attrs:{id:"summary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#summary"}},[e._v("#")]),e._v(" Summary")]),e._v(" "),a("p",[e._v("This challenge showed how to create a new application in AAD and how user can be authenticated using the Open ID Connect protocol. The full process is described "),a("a",{attrs:{href:"https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-protocols-oidc",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1),e._v(".")])])}),[],!1,null,null,null);t.default=o.exports}}]);