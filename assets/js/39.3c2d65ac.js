(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{595:function(e,t,a){"use strict";a.r(t);var r=a(42),s=Object(r.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"challenge-1-powershell-configure-powershell-for-azure-administration-create-a-vm-using-powershell"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#challenge-1-powershell-configure-powershell-for-azure-administration-create-a-vm-using-powershell"}},[e._v("#")]),e._v(" Challenge 1: PowerShell: Configure PowerShell for Azure Administration & Create a VM Using PowerShell.")]),e._v(" "),a("p",[a("RouterLink",{attrs:{to:"/day1/"}},[e._v("back")])],1),e._v(" "),a("h2",{attrs:{id:"here-is-what-you-will-learn"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#here-is-what-you-will-learn"}},[e._v("#")]),e._v(" Here is what you will learn")]),e._v(" "),a("ul",[a("li",[e._v("Which PowerShell modules to download for Azure administration")]),e._v(" "),a("li",[e._v("How to update the modules as version updates "),a("strong",[e._v("will")]),e._v(" happen.")]),e._v(" "),a("li",[e._v("Use help with "),a("em",[e._v("-examples")]),e._v(" to speed your coding through code snippets")]),e._v(" "),a("li",[e._v("Deploy your first Azure VM using code.")])]),e._v(" "),a("h2",{attrs:{id:"install-powershell-az-modules-for-azure"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#install-powershell-az-modules-for-azure"}},[e._v("#")]),e._v(" Install PowerShell Az Modules for Azure")]),e._v(" "),a("p",[e._v("Open PowerShell "),a("strong",[e._v("as administrator")]),e._v(" and execute:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Install-Module Az\n")])])]),a("p",[e._v("Press 'Y' and allow the installation of the latest Nuget Package Provider:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("NuGet provider is required to continue\nPowerShellGet requires NuGet provider version '2.8.5.201' or newer to interact with NuGet-based repositories. The NuGet\n provider must be available in 'C:\\Program Files\\PackageManagement\\ProviderAssemblies' or\n'C:\\Users\\Administrator\\AppData\\Local\\PackageManagement\\ProviderAssemblies'. You can also install the NuGet provider by\n running 'Install-PackageProvider -Name NuGet -MinimumVersion 2.8.5.201 -Force'. Do you want PowerShellGet to install\nand import the NuGet provider now?\n[Y] Yes  [N] No  [S] Suspend  [?] Help (default is \"Y\"): y\n")])])]),a("p",[e._v("Press 'A' to make the PowerShell Gallery a trusted code repository - this is the Code source for the Azure Az modules:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Untrusted repository\nYou are installing the modules from an untrusted repository. If you trust this repository, change its\nInstallationPolicy value by running the Set-PSRepository cmdlet. Are you sure you want to install the modules from\n'PSGallery'?\n[Y] Yes  [A] Yes to All  [N] No  [L] No to All  [S] Suspend  [?] Help (default is \"N\"): a\n")])])]),a("p",[e._v("The installation will take a while. After install you can query the modules and it's versions using:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("get-module Az* -ListAvailable\n")])])]),a("p",[e._v("Output will be something like:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Directory: C:\\Program Files\\WindowsPowerShell\\Modules\n\n\nModuleType Version    Name                                ExportedCommands\n---------- -------    ----                                ----------------\nScript     1.4.0      Az.Accounts                         {Disable-AzDataCollection, Disable-AzContextAutosave, Enab...\nScript     1.0.1      Az.Aks                              {Get-AzAks, New-AzAks, Remove-AzAks, Import-AzAksCredentia...\nScript     1.0.2      Az.AnalysisServices                 {Resume-AzAnalysisServicesServer, Suspend-AzAnalysisServic...\nScript     1.0.0      Az.ApiManagement                    {Add-AzApiManagementRegion, Get-AzApiManagementSsoToken, N...\nScript     1.0.0      Az.ApplicationInsights              {Get-AzApplicationInsights, New-AzApplicationInsights, Rem...\nScript     1.2.0      Az.Automation                       {Get-AzAutomationHybridWorkerGroup, Remove-AzAutomationHyb...\nScript     1.0.0      Az.Batch                            {Remove-AzBatchAccount, Get-AzBatchAccount, Get-AzBatchAcc...\nScript     1.0.0      Az.Billing                          {Get-AzBillingInvoice, Get-AzBillingPeriod, Get-AzEnrollme...\nScript     1.1.0      Az.Cdn                              {Get-AzCdnProfile, Get-AzCdnProfileSsoUrl, New-AzCdnProfil...\nScript     1.0.1      Az.CognitiveServices                {Get-AzCognitiveServicesAccount, Get-AzCognitiveServicesAc...\nScript     1.6.0      Az.Compute                          {Remove-AzAvailabilitySet, Get-AzAvailabilitySet, New-AzAv...\nScript     1.0.0      Az.ContainerInstance                {New-AzContainerGroup, Get-AzContainerGroup, Remove-AzCont...\nScript     1.0.1      Az.ContainerRegistry                {New-AzContainerRegistry, Get-AzContainerRegistry, Update-...\n.\n.\n.\n")])])]),a("h2",{attrs:{id:"first-steps-login-to-azure-and-select-your-target-subscription"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#first-steps-login-to-azure-and-select-your-target-subscription"}},[e._v("#")]),e._v(" First Steps: Login to Azure and select your target subscription...")]),e._v(" "),a("p",[e._v("To Login open PowerShell and execute:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Login-AzAccount\n")])])]),a("p",[e._v("List the available Azure subscriptions:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Get-AzSubscription\n")])])]),a("p",[e._v("Output will be something like:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Name                     Id                                   TenantId                             State\n----                     --                                   --------                             -----\nAzure Pass - Sponsorship 79021c9b-147b-4dc0-ab8c-a3de94905f3f c097c15f-e692-4b72-8f72-490b95209f57 Enabled\n\n")])])]),a("p",[e._v("To select a specific subscription as target for further deployments you might want to ask the user:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Get-AzSubscription | Out-GridView -PassThru | Set-AzContext\n")])])]),a("p",[e._v("Now after the context has been set you can query subscription specific details e.g. the available VM sizes in a specific region:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Get-AzVMSize -Location 'west europe'\n")])])]),a("p",[e._v("Output should be something like:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Name                   NumberOfCores MemoryInMB MaxDataDiskCount OSDiskSizeInMB ResourceDiskSizeInMB\n----                   ------------- ---------- ---------------- -------------- --------------------\nStandard_A0                        1        768                1        1047552                20480\nStandard_A1                        1       1792                2        1047552                71680\nStandard_A2                        2       3584                4        1047552               138240\nStandard_A3                        4       7168                8        1047552               291840\n.\n.\n.\n\n")])])]),a("p",[a("strong",[e._v("Note:")]),e._v(" Azure resources (e.g. a virtual machine's hard disk) are provided through so called Azure Resource Providers.\nIn order to create a specific resource (e.g. a VM) you have to talk to the correct resource provider (e.g. Microsoft.Compute).\nThese resource providers implement the feature (e.g. a VM) in a specific region. You don't have to learn whom to talk to and where which resource providers are available - because the PowerShell Az modules you just installed do this for you."),a("br"),e._v("\nThe Az modules are "),a("em",[e._v("sort of")]),e._v(" aligned to Azure Resource Providers, i.e.")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("What do you want to create")]),e._v(" "),a("th",[e._v("Responsible Azure Resource Provider")]),e._v(" "),a("th",[e._v("PowerShell Module to use")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("Create a VM")]),e._v(" "),a("td",[e._v("Microsoft.Compute")]),e._v(" "),a("td",[e._v("Az.Compute")])]),e._v(" "),a("tr",[a("td",[e._v("Create a virtual network")]),e._v(" "),a("td",[e._v("Microsoft.Network")]),e._v(" "),a("td",[e._v("Az.Network")])]),e._v(" "),a("tr",[a("td",[e._v("...")]),e._v(" "),a("td",[e._v("...")]),e._v(" "),a("td",[e._v("...")])])])]),e._v(" "),a("p",[e._v("So the commands for creating a VM are "),a("em",[e._v("'hidden'")]),e._v(" in Az.Compute.\nExecute:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Get-Command -Module Az.Compute\n")])])]),a("p",[e._v("delivers e.g.:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("CommandType     Name                                               Version    Source\n-----------     ----                                               -------    ------\n.\n.\n.\nCmdlet          Invoke-AzVMRunCommand                              3.0.0      Az.Compute\nCmdlet          Invoke-AzVmssVMRunCommand                          3.0.0      Az.Compute\nCmdlet          New-AzVM                                           3.0.0      Az.Compute\nCmdlet          New-AzVMConfig                                     3.0.0      Az.Compute\nCmdlet          New-AzVMDataDisk                                   3.0.0      Az.Compute\nCmdlet          New-AzVMSqlServerAutoBackupConfig                  3.0.0      Az.Compute\n.\n.\n.\n")])])]),a("h2",{attrs:{id:"create-a-vm-with-powershell"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#create-a-vm-with-powershell"}},[e._v("#")]),e._v(" Create a VM with PowerShell ...")]),e._v(" "),a("p",[e._v("Now "),a("strong",[e._v("let's create a vm using PowerShell")]),e._v(". But we are lazy and want to be fast so we copy example code from PowerShell help:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("help New-AzVM -Examples | clip\n")])])]),a("p",[e._v("copies the example code to the clipboard. Open PowerShell ISE and do a "),a("strong",[e._v("CTRL-V")]),e._v(" to paste the code into a editor window.\nPlease "),a("strong",[e._v("choose example 3")]),e._v(" and remove the rest:\n"),a("img",{attrs:{src:"New-AzVMinPowerShell.PNG",alt:"PowerShell ISE"}})]),e._v(" "),a("p",[a("strong",[e._v("Now it's your turn")]),e._v(": e.g. remove errors - (superflous line breaks), use variables, implement the resource group creation, add login-azaccount, subscription selection...")]),e._v(" "),a("p",[a("strong",[e._v("Does it run?")]),e._v(" If yes, watch in the portal what happens.\n"),a("strong",[e._v("What is missing | outdated?")])]),e._v(" "),a("p",[e._v("After a successful run. "),a("strong",[e._v("Cleanup")]),e._v(" e.g. by deleting the resource group with the vm using the portal")]),e._v(" "),a("p",[a("RouterLink",{attrs:{to:"/day1/"}},[e._v("back")])],1)])}),[],!1,null,null,null);t.default=s.exports}}]);